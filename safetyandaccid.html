<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>TMI: Data Analysis Page</title>
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js">
	</script>
	<script type="text/javascript" src="http://code.highcharts.com/highcharts.js"></script>
	<script type="text/javascript" src="js/exporting.js"></script>
	<!-- <script type="text/javascript" src="js/exporting.js"></script> -->
	<script type="text/javascript" src="http://www.parsecdn.com/js/parse-1.4.2.min.js">
	</script>
	<script> Parse.initialize("6s0wYYKZR2sQU8zMV304cL8jv5Pdmp3PzOIwKLOp", "7C1XQAKjUdhiH6k25tRIbVOweuNMoFy0n0An4LJf"); 
	</script>
</head>

<body>
	<div id="container" style="width: 800px; height: 400px; margin: 0 auto"></div>
	<script>

//Load data from accidents.csv and accidentsPerDay.csv into arrays using Parse.
function QueryServer() {

	//var accidents = Parse.Object.extend("accidents");
	//var query = new Parse.Query(accidents);
	var safetyandaccid = Parse.Object.extend("safetyandaccid");
	var query = new Parse.Query(safetyandaccid);

	query.limit(30);
	query.find({

		success: function(results) {
			alert("Results found:" + results.length);

			//Create an accidents array to store the accidents from the accidents.csv file.
			//var accidentsArray = new Array();
			//Accidents per day array to store accidents per day from the accidentsPerDay.csv file.
			/*var accidentsPerDayArray = new Array();

			for (var i = 0; i < results.length; i++){
				var object = results[i];
				//accidentsArray.push([object.get('UMTRI_ID'), object.get('Date'), object.get('Accident Month'), object.get('Accident Day'), object.get('Accident Year'), object.get('Time of Day'), object. get('Weather'), object.get('Total Motor Vehicles'), object.get('Gps X Coordinate'), object.get('Gps Y Coordinate')]);
				accidentsPerDayArray.push([object.get('Date'), object.get('Count')]);

			}*/

			CreateChart(results);

		},

		error: function(error) {
			alert("Error: " + error.code + " " + error.message);
		}

	});

}

function CreateChart(results) {

	var options = {
					
		chart: {
		            renderTo: 'container',
		            type: 'column'
		        },
		        title: {
		            text: 'Percent Change of Accidents and Safety Ratings'
		        },
		        xAxis: {
						type: 'datetime',
						categories: []
		        },
		        yAxis: {
		            min: 0,
		            title: {
		                text: 'Total fruit consumption'
		            }
		        },
		        tooltip: {
		            formatter: function () {
		                return '<b>' + this.x + '</b><br/>' +
		                    this.series.name + ': ' + this.y + '<br/>' +
		                    'Total: ' + this.point.stackTotal;
            }
		        },
		        plotOptions: {
		            column: {
		                stacking: 'normal'
		            }
		        },
		        series: []
		    };
			
					
					
				var series0 = {
		            name: 'safety',
					data: [],
					stack: '2011'

				}
				
				var series1 = {
		            name: 'accident',					
					data: [],
					stack: '2011'
				}
				


				for (var i = 0; i < results.length; i++){
					amount = results[i].get('safe');
		
	
					//months = results[i].get('Month');


					//options.xAxis.categories.push(months);

					series0.data.push(amount);				


				}



			options.series.push(series0);
			var chart = new Highcharts.Chart(options);
			}


			$(document).ready(function() {
				QueryServer();
			});


		</script>

</body>
</html>
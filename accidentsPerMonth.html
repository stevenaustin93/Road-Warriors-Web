<html>
	<head>
		<!-- not sure what this is -->
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

		<!-- Tab Title -->
		<title>TMI: Data Analysis Page</title>

		<!-- Import jQuery -->
		<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js">
		</script>

		<!-- Import Highcharts -->
		<script type="text/javascript" src="http://code.highcharts.com/highcharts.js">
		</script>

        <!-- <script type="text/javascript" src="js/exporting.js"></script> -->
		<script type="text/javascript" src="http://www.parsecdn.com/js/parse-1.4.2.min.js">
		</script>

		<!-- Initialize parse -->
		<script> Parse.initialize("6s0wYYKZR2sQU8zMV304cL8jv5Pdmp3PzOIwKLOp", "7C1XQAKjUdhiH6k25tRIbVOweuNMoFy0n0An4LJf"); 
		</script>
	</head>

	<body>

		<div id="container" style="width: 800px; height: 400px; margin: 0 auto"></div>

		<script>

			//Load data from accidents.csv and accidentsPerDay.csv into arrays using Parse.
			function QueryServer() {

				var accidentsPerMonth = Parse.Object.extend("accidentsPerMonth");
				var query = new Parse.Query(accidentsPerMonth);

				query.limit(400);
				query.find({
					
					success: function(results) {
					  	alert("Results found:" + results.length);
						CreateChart(results);
					},
					error: function(error) {
						alert("Error: " + error.code + " " + error.message);
					}
				});
			}

			function CreateChart(results) {
				
				var options = {
					
					chart: {
						renderTo: 'container',
						type: 'spline'
					},
					
					title: {
						text: 'Accidents per Month in Ann Arbor during 2013'
					},
					
					xAxis: {
						type: 'datetime',
						categories: ['January','February','March','April','May','June','July','August','September','October','November','December']
					},

					yAxis: {
						title: {
							text: 'Accidents'
						}
					},

	                credits: {
                       	enabled: false
                    },

					series: []

				};
					
				var series0 = {
					name: ['Number of Accidents'],
					data: []
				}

				var amount;
				var months = [];
				for (var i = 0; i < results.length; i++){
					amount = results[i].get('Count');
					months.push(results[i].get('Months'));

					options.xAxis.categories.push(months);
					series0.data.push(amount);
				}


			options.series.push(series0);
			var chart = new Highcharts.Chart(options);
			}


			$(document).ready(function() {
				QueryServer();
			});


		</script>
	</body>
</html>